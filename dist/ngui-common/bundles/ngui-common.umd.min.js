!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("rxjs/internal/observable/fromEvent")):"function"==typeof define&&define.amd?define("@ngui/common",["exports","@angular/core","@angular/common","rxjs/internal/observable/fromEvent"],e):e((t.ngui=t.ngui||{},t.ngui.common={}),t.ng.core,t.ng.common,t.rxjs["internal/observable/fromEvent"])}(this,function(t,o,e,n){"use strict";var i=function(){function t(t,e){this.element=t,this.platformId=e,this.observerOptions={threshold:[.1,.2,.3,.4,.5,.6,.7,.8]},this.blurEnabled=!0,this.inview=new o.EventEmitter,this.notInview=new o.EventEmitter,this.isInview=!1,this.once80PctVisible=!1}return t.prototype.ngOnInit=function(){this.options&&(this.observerOptions=this.options),e.isPlatformBrowser(this.platformId)&&(this.observer=new IntersectionObserver(this.handleIntersect.bind(this),this.observerOptions),this.observer.observe(this.element.nativeElement))},t.prototype.ngOnDestroy=function(){this.observer.disconnect()},t.prototype.handleIntersect=function(t){var e=this;t.forEach(function(t){t.isIntersecting?(e.isInview=!0,e.defaultInviewHandler(t),e.inview.emit(t)):e.notInview.emit(t)})},t.prototype.defaultInviewHandler=function(t){if(this.blurEnabled&&!this.once80PctVisible&&!this.inview.observers.length)if(t.intersectionRatio<.8){var e=1.25*t.intersectionRatio,n="blur("+(20-4*Math.floor(10*t.intersectionRatio))+"px)";Object.assign(t.target.style,{opacity:e,filter:n})}else t.target.style.opacity=1,t.target.style.filter="unset",this.once80PctVisible=!0},t.decorators=[{type:o.Component,args:[{selector:"ngui-inview",template:'\n        <ng-container *ngIf="isInview" [ngTemplateOutlet]="template">\n        </ng-container>\n    ',styles:[":host {display: block;}"]}]}],t.ctorParameters=function(){return[{type:o.ElementRef},{type:undefined,decorators:[{type:o.Inject,args:[o.PLATFORM_ID]}]}]},t.propDecorators={template:[{type:o.ContentChild,args:[o.TemplateRef]}],observerOptions:[{type:o.Input}],options:[{type:o.Input}],blurEnabled:[{type:o.Input}],inview:[{type:o.Output}],notInview:[{type:o.Output}]},t}(),s=function(){function t(t,e){this.element=t,this.platformId=e,this.observerOptions={threshold:[.1,.2,.3,.4,.5,.6,.7,.8]},this.nguiInview=new o.EventEmitter,this.nguiOutview=new o.EventEmitter}return t.prototype.ngOnInit=function(){this.options&&(this.observerOptions=this.options),e.isPlatformBrowser(this.platformId)&&(this.observer=new IntersectionObserver(this.handleIntersect.bind(this),this.observerOptions),this.observer.observe(this.element.nativeElement))},t.prototype.ngOnDestroy=function(){e.isPlatformBrowser(this.platformId)&&this.observer&&this.observer.disconnect()},t.prototype.handleIntersect=function(t){var e=this;t.forEach(function(t){t.isIntersecting?e.nguiInview.emit(t):e.nguiOutview.emit(t)})},t.decorators=[{type:o.Directive,args:[{selector:"[nguiInview], [nguiOutview]"}]}],t.ctorParameters=function(){return[{type:o.ElementRef},{type:undefined,decorators:[{type:o.Inject,args:[o.PLATFORM_ID]}]}]},t.propDecorators={observerOptions:[{type:o.Input}],options:[{type:o.Input}],nguiInview:[{type:o.Output}],nguiOutview:[{type:o.Output}]},t}(),r=function(){function t(){}return t.decorators=[{type:o.NgModule,args:[{imports:[e.CommonModule],declarations:[i,s],exports:[i,s]}]}],t}(),p=function(t,e){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function a(t,e,n){var i;return void 0===n&&(n={}),"click"===e||e.match(/^mouse/)?i=new MouseEvent(e,n):e.match(/^key/)?i=new KeyboardEvent(e,n):e.match(/^touch/)&&(i=new TouchEvent(e,n)),t.dispatchEvent(i)}var u=function(){function t(t){this.factoryResolver=t}return t.prototype.createComponent=function(t,e){return this.rootViewContainer=e||this.rootViewContainer,this.factoryResolver.resolveComponentFactory(t).create(this.rootViewContainer.parentInjector)},t.prototype.insertComponent=function(t){var e="ngui-dyn-"+(Math.floor(Math.random()*Math.pow(10,7))+Math.pow(10,6));return t.location.nativeElement.setAttribute("id",e),t.instance.id=e,this.rootViewContainer.insert(t.hostView),t.instance},t.decorators=[{type:o.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:o.Inject,args:[o.ComponentFactoryResolver]}]}]},t}(),c=function(){function t(t,e,n){this.element=t,this.renderer=e,this.cdRef=n,this.outView=!1,this.itemsBackup=[]}return t.prototype.restoreItems=function(){this.outView&&(this.outView=!1,this.items=Array.from(this.itemsBackup||[]),this.itemsBackup=undefined,this.renderer.setStyle(this.contentsEl,"height",undefined),this.cdRef.detectChanges())},t.prototype.ngOnInit=function(){this.contentsEl=this.element.nativeElement.querySelector(".inview-page.contents")},t.prototype.ngOnDestroy=function(){console.log("NguiInviewPageComponent.ngOnDestroy() is called"),this.destroyed=!0},t.prototype.emptyItems=function(){if(this.items&&this.contentsEl&&!this.outView){var t=this.element.nativeElement.getBoundingClientRect().height;this.renderer.setStyle(this.contentsEl,"height",t+"px"),this.outView=!0,this.itemsBackup=Array.from(this.items||[]),this.items=undefined,this.destroyed||this.cdRef.detectChanges()}},t.prototype.setItems=function(t){this.destroyed||(console.log("NguiInviewPageComponent.setItems() is called with",t),this.items=t,this.cdRef.detectChanges())},t.decorators=[{type:o.Component,args:[{selector:"ngui-inview-page",template:'\n    <div class="inview-page contents"\n      (nguiInview)="restoreItems()"\n      (nguiOutview)="emptyItems()">\n      \x3c!-- add blank ngui-list-item by condition  --\x3e\n      \x3c!-- no match found ngui-list-item by condition --\x3e\n      <ng-container\n        [ngTemplateOutlet]="template||defaultTemplate"\n        [ngTemplateOutletContext]="{items: items, outView: outView}">\n      </ng-container>\n      <div *ngIf="outView">{{ itemsBackup.length }} items hidden</div>\n    </div>\n\n    <ng-template #defaultTemplate>\n      <div *ngIf="!items"> Error: requires [items] </div>\n      <div *ngIf="!template"> Error: requires &lt;ng-template></div>\n    </ng-template>\n  ',styles:["\n    :host {display: block}\n  "]}]}],t.ctorParameters=function(){return[{type:o.ElementRef},{type:o.Renderer2},{type:o.ChangeDetectorRef}]},t.propDecorators={template:[{type:o.ContentChild,args:[o.TemplateRef]}],items:[{type:o.Input}]},t}(),l=function(){function t(t,e,n,i){this.renderer=t,this.element=e,this.dynamicComponentService=n,this.cdr=i,this.selected=new o.EventEmitter,this.escaped=new o.EventEmitter,this.bottomInview=new o.EventEmitter,this._focused=!1,this.inviewPages=[]}return t.prototype.ngAfterViewInit=function(){this.template&&this.bottomInview.observers.length||console.error("<ngui-virtual-list> requires [template] and {bottomInview)")},t.prototype.addAnInviewPageToPages=function(){this.isListLoading?console.log("Already a page being inserted, skipping adding a page"):(this.isListLoading=!0,this.inviewPage=this.dynamicComponentService.createComponent(c,this.pagesRef),this.dynamicComponentService.insertComponent(this.inviewPage),this.inviewPage.instance.template=this.template,this.inviewPages.push(this.inviewPage),this.bottomInview.emit(this))},t.prototype.addList=function(t){this.isListLoading=!1,console.log(">>>>>> NguiVirtualListComponent.addList() is called()"),this.inviewPage.instance.setItems(t)},t.decorators=[{type:o.Component,args:[{selector:"ngui-virtual-list",template:'\n    <div class="ngui-virtual-list"\n      (focus)="_focused = true"\n      (click)="_focused = true">\n      \x3c!-- hold multiple <ngui-inview-page> --\x3e\n      <div #pages></div>\n      \x3c!-- insert <ngui-inview-page> into #pages --\x3e\n      <ngui-inview (inview)="addAnInviewPageToPages()"></ngui-inview>\n    </div>\n  ',styles:["\n    :host {display: block}\n  "]}]}],t.ctorParameters=function(){return[{type:o.Renderer2},{type:o.ElementRef},{type:u},{type:o.ChangeDetectorRef}]},t.propDecorators={pagesRef:[{type:o.ViewChild,args:["pages",{read:o.ViewContainerRef}]}],template:[{type:o.ContentChild,args:[o.TemplateRef]}],selected:[{type:o.Output}],escaped:[{type:o.Output}],bottomInview:[{type:o.Output}]},t}(),h=function b(){this.html="No Match Found"},d=function L(){this.html="Select"},m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.minInputChars=1,t.blankOption="Select One",t.noMatchItem="No Match Found",t._focused={input:!1,listItem:!1},t}return function i(t,e){function n(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(t,e),Object.defineProperty(t.prototype,"isReady",{get:function(){var t=this._selectedFromList||this._escapedFromList,e=this._focused.input||this._focused.listItem,n=this.inputEl.value.length>=this.minInputChars;return!t&&e&&n},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.inputEl=document.querySelector("#"+this["for"]),this.positionThisUnderInputEl(),n.fromEvent(this.inputEl,"keyup").subscribe(this.onInputElKeyup.bind(this)),this.inputEl.addEventListener("focus",this.onInputElFocused.bind(this)),this.inputEl.addEventListener("blur",this.onInputElBlurred.bind(this)),this.selected.subscribe(this.onSelected.bind(this)),this.escaped.subscribe(this.onEscaped.bind(this))},t.prototype.onSelected=function(t){this._selectedFromList=!0,this.inputEl.focus(),this._lastSelected=t,this.cdr.detectChanges(),console.log("NguiAutoCompleteComponent.onSelected() is called",t)},t.prototype.onEscaped=function(){this._escapedFromList=!0,this.inputEl.focus(),this._lastSelected||(this.inputEl.value=this._orgInputValue),this.cdr.detectChanges(),console.log("NguiAutoCompleteComponent.onEscaped() is called")},t.prototype.onInputElFocused=function(t){console.log("NguiAutoCompleteComponent.onInputElFocused() is called",t),this.isListLoading=!1,"undefined"==typeof this._orgInputValue&&(this._orgInputValue=this.inputEl.value),this._prevInputValue=this.inputEl.value,this.setFocused("input",!0)},t.prototype.onInputElBlurred=function(){this.setFocused("input",!1)},t.prototype.clearList=function(){this.inviewPages.forEach(function(t){t.destroy()}),this.inviewPages=[]},t.prototype.onInputElKeyup=function(t){console.log("NguiAutoCompleteComponent.onInputKeyup() is called",t.key);var e=this.element.nativeElement.querySelector("ngui-list-item");"Enter"===t.key||"Escape"===t.key?e?a(e,"keyup",{key:t.key}):this.onEscaped():"ArrowDown"!==t.key&&"ArrowRight"!==t.key||!e?"ArrowUp"===t.key||"ArrowLeft"===t.key||this.inputEl.value.length>=this.minInputChars&&(this._selectedFromList=!1,this._escapedFromList=!1,this.addAutocompleteList()):e.focus()},t.prototype.addAutocompleteList=function(){var t=this;this.isReady&&(clearTimeout(this._acTimer),this._acTimer=setTimeout(function(){t.isListLoading=!1,t._prevInputValue=t.inputEl.value,t._escapedFromList=!1,t._selectedFromList=!1,t.clearList(),t.addAnInviewPageToPages()},200))},t.prototype.addMorePages=function(){this.inviewPages.length&&this.addAnInviewPageToPages()},t.prototype.setFocused=function(t,e){var n=this;e?(clearTimeout(this._focusTimer),this._focused={input:!1,listItem:!1},this._focused[t]=!0):this._focusTimer=setTimeout(function(){n._focused[t]=!1,n.cdr.detectChanges()},100)},t.prototype.positionThisUnderInputEl=function(){var t=this.element.nativeElement,e=this.inputEl.getBoundingClientRect(),n=e.top+e.height+window.scrollY;this.renderer.setStyle(t,"left",e.left+"px"),this.renderer.setStyle(t,"top",n+"px"),this.renderer.setStyle(t,"minWidth",e.width+"px")},t.prototype.addList=function(t){var e;console.log(">>>>>> NguiAutocompleteComponent.addList() is called()"),this.isListLoading=!1;var n={};1===this.inviewPages.length&&(!this.noMatchItem||t&&0!==t.length?this.blankOption&&((n=new d).html=this.blankOption):(e=new h,n.html=this.noMatchItem));var i=[].concat(e,n,t).filter(function(t){return t});this.inviewPage.instance.setItems(i),this.cdr.detectChanges()},t.decorators=[{type:o.Component,args:[{selector:"ngui-autocomplete",template:'\n    <div *ngIf="isReady" class="ngui-autocomplete">\n      <div #pages></div>\n      <ngui-inview (inview)="addMorePages()"></ngui-inview>\n    </div>\n  ',styles:["\n    :host {position: absolute; background-color: #fff; max-height: 300px; overflow: auto}\n    .ngui-autocomplete { border: 1px solid #ccc; padding: 4px }\n  "]}]}],t.propDecorators={"for":[{type:o.Input}],minInputChars:[{type:o.Input}],blankOption:[{type:o.Input}],noMatchItem:[{type:o.Input}],template:[{type:o.ContentChild,args:[o.TemplateRef]}]},t}(l),g=function(){function t(t){this.element=t,this.selected=new o.EventEmitter,this.escaped=new o.EventEmitter}return t.decorators=[{type:o.Directive,args:[{selector:"ngui-list"}]}],t.ctorParameters=function(){return[{type:o.ElementRef}]},t.propDecorators={selected:[{type:o.Output}],escaped:[{type:o.Output}]},t}(),f=function(){function t(t,e,n,i,o,s){this.el=t,this.renderer=e,this.viewContainer=n,this.listDirective=i,this.virtualListComponent=o,this.autocompleteComponent=s}return t.prototype.ngOnInit=function(){if(this.renderer.setAttribute(this.el.nativeElement,"tabindex","0"),this.parentListComp=this.listDirective||this.virtualListComponent||this.autocompleteComponent,!this.parentListComp)throw Error("ngui-list-item requires parent of ngui-list, ngui-virtual-list, or ngui-autocomplete.");(this.object instanceof d||this.object instanceof h)&&(this.viewContainer.clear(),this.el.nativeElement.innerHTML=this.object.html)},t.prototype.keydown=function(t){var e=this.el.nativeElement,n=t.which||t.keyCode,i=this.parentListComp.element.nativeElement,o=Array.from(i.querySelectorAll("ngui-list-item")),s=o.indexOf(e),r=o[s+1]||o[0],p=o[s-1]||o[o.length-1];switch(n){case 37:case 38:p.focus();break;case 39:case 40:r.focus()}},t.prototype.keyup=function(t){switch(t.key){case"Enter":this.parentListComp.selected.emit(this.object);break;case"Escape":this.parentListComp.escaped.emit()}},t.prototype.mousedown=function(){this.parentListComp.selected.emit(this.object)},t.prototype.focused=function(){this.parentListComp.setFocused&&this.parentListComp.setFocused("listItem",!0)},t.prototype.blurred=function(){this.parentListComp.setFocused&&this.parentListComp.setFocused("listItem",!1)},t.decorators=[{type:o.Directive,args:[{selector:"ngui-list-item"}]}],t.ctorParameters=function(){return[{type:o.ElementRef},{type:o.Renderer2},{type:o.ViewContainerRef},{type:g,decorators:[{type:o.Optional},{type:o.Host}]},{type:l,decorators:[{type:o.Optional},{type:o.Host}]},{type:m,decorators:[{type:o.Optional},{type:o.Host}]}]},t.propDecorators={object:[{type:o.Input,args:["item"]}],keydown:[{type:o.HostListener,args:["keydown",["$event"]]}],keyup:[{type:o.HostListener,args:["keyup",["$event"]]}],mousedown:[{type:o.HostListener,args:["click",["$event"]]}],focused:[{type:o.HostListener,args:["focus",["$event"]]}],blurred:[{type:o.HostListener,args:["blur",["$event"]]}]},t}(),v=function(){function t(){}return t.decorators=[{type:o.NgModule,args:[{imports:[e.CommonModule,r],declarations:[m,c,g,f,l],exports:[m,c,g,f,l],entryComponents:[c]}]}],t}(),y=function(){function t(){}return t.prototype.transform=function(t,e){var n=t;if(e){var i=new RegExp(e,"ig");n=t.replace(i,function(t){return'<span class="ngui-highlight">'+t+"</span>"})}return n},t.decorators=[{type:o.Pipe,args:[{name:"nguiHighlight"}]}],t}(),w=function(){function t(){}return t.toLog=function(t){return this.LOG_LEVELS[this.logLevel]<this.LOG_LEVELS[t]},t.setLogLevel=function(t){t=t.toUpperCase();var e=Object.keys(this.LOG_LEVELS);-1<e.indexOf(t)?(window&&window.sessionStorage&&window.sessionStorage.setItem("konsole.LOG_LEVEL",t),this.logLevel=t):console.error("Error, invalid logLevel, it must be one of "+e)},t.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.toLog("DEBUG")&&console.debug.apply(console,arguments)},t.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.toLog("LOG")&&console.log.apply(console,arguments)},t.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.toLog("INFO")&&console.info.apply(console,arguments)},t.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.toLog("WARN")&&console.warn.apply(console,arguments)},t.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.toLog("ERROR")&&console.error.apply(console,arguments)},t.LOG_LEVELS={ALL:parseInt("00000",2),DEBUG:parseInt("00001",2),LOG:parseInt("00010",2),INFO:parseInt("00100",2),WARN:parseInt("01000",2),ERROR:parseInt("10000",2),NONE:parseInt("11111",2)},t.logLevel="INFO",t}(),I=function(){function t(){}return t.decorators=[{type:o.NgModule,args:[{imports:[e.CommonModule],declarations:[y],exports:[y],providers:[u]}]}],t}(),E=function(){function t(){}return t.decorators=[{type:o.NgModule,args:[{imports:[r,v,I],exports:[r,v,I]}]}],t}();t.NguiInviewComponent=i,t.NguiInviewDirective=s,t.NguiInviewModule=r,t.NguiAutocompleteComponent=m,t.NguiListItemDirective=f,t.NguiListDirective=g,t.NguiInviewPageComponent=c,t.NguiVirtualListComponent=l,t.NguiListModule=v,t.DynamicComponentService=u,t.NguiHighlightPipe=y,t.konsole=w,t.fireEvent=a,t.NguiUtilsModule=I,t.NguiCommonModule=E,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngui-common.umd.min.js.map